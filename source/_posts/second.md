---
title: 'ARFA 教堂的第二次洗礼 相关事宜&题解'
date: 2019-02-03 17:50
category: 比赛相关
id: second-competition
---
<style>
.lyric:hover, .lyric-from:hover {
  text-shadow: 0 0 1px #fff, 0 0 5px #fff, 0 0 3px #000;
  opacity: 0.5;
  transition: all 0.3s ease;
}
.lyric, .lyric-from {
    transition: all 0.3s ease;
}
</style>

<blockquote class="blockquote-center">
<p class="lyric">傷だらけの硝子の心が、忘れかけた熱を灯す。</p>
<p class="lyric">遍体鳞伤的琉璃之心，将快被忘却的灯火点燃。</p>
<span class="lyric-from" style="float: right; ">Aimer - LAST STARDUST</span>
</blockquote>

白驹过隙，乌飞兔走；残雪易逝，韶华难留。岁月在命令行的闪烁间，不时地发出一声低语。  
此时，在代码的字里行间和教堂给予的箴语间，我虔诚地体会着这呢喃。  
「是啊，时候到了！」
<!--more-->

好的，这里才是正题。前面那些东西是中二病晚期 Alpha1022 写的（当然这里也是他/我写的）。  
第二次洗礼~~暂定于大年三十（2.4）延期到初一（2.5）~~调整到大年三十正午到傍晚 8 点~~，当然由于洛谷的管理员比我们还咕，所以随时会延期~~。  
这次教主 ARFA 由于一些问题，原定的唯一一道题目被亲自枪毙，将会在下一次洗礼与大家见面。  
此外，这次的出题人加入了一位巨佬：坐标 TJ 的天河大佬，洛谷 ID cuking，NOI2018 Ag。

# 出题情况

|题号|出题人|
|:-:|:-:|
|1|SXnoname|
|2|alpha1022|
|3|SXnoname|
|4|SXnoname|
|5|alpha1022 & SXnoname|
|6|cuking|

# 出题人的叮嘱

- alpha1022:

  T2 对于 SX 的同学的一个声明：LHF 不是 LiuHaiFeng 而是 LiHaoFu 大佬，谢谢，不要误会。另外请 SX 本家同学多多关注~~，文体两开花~~。

- SXnoname:

  这场比赛画风清奇，有参考北大出题风格，请各位 AKer 们慢点 AK。

- cuking:

  无。

- ARFA:

  我在准备下一个比赛的签到题，所以不能出水题了！

# 答疑

可以在[此帖](https://www.luogu.org/discuss/show?postid=98312)也可在此下评论。

# 题解

## A
$50\%$数据？直接全排列模拟题意。  
$80 \%$数据？貌似没啥用。  
$100 \%$数据，考虑对每个数算贡献，一个数怎么才会贡献？当所有他的因子的数都在它后面。  
那么我们只要预处理序列里它所有因子，把他们放到它的后面即可。设是它因子的数有$x$个。  
那么它对答案的贡献就是：$a_i*C^{x+1}_n*x!*(n-x-1)!$。  
这题就$O(n \sqrt{a_i})$做完了。

## B
注意一个毒瘤的地方：前面的数据没有指定 $m$ 的大小。  
然后就是显然的平衡树乱搞啦，`P` 操作可以统计结点的排名，`Q` 操作可以状压。

## C
这题过于套路和裸。  
首先根据裴蜀定理，可以得到：就是让我们选若干个装备使他们威力值$\gcd$为$1$的方案。  
前$10 \%$数据：直接$2^n$枚举每个装备选不选。  
前$30 \%$数据：设$f_{i,j}$表示到第$i$个数，当前已选数$\gcd$为$j$的方案。直接转移即可。复杂度$O(n^2)$  
前$60 \%$数据：跟$\gcd$有关系不妨想想反演，设$g(i)$表示选的所有数$gcd$为$i$的倍数的方案。那么有  
$$ans=\sum_{i=1}^n \mu(i)g(i)$$  
$$g(i)=2^{\lfloor\frac{n}{x}\rfloor}-1$$  
考虑每一个它的倍数选或不选，减掉空集方案即可。  
所有数据：指数可以整除分块，套路的再套上一个杜教筛就可以了，复杂度$O(n^{\frac{2}{3}})$。

## D
这题过于裸。  
基本上会$prufer$序列都会了这道题。  
题意就是求有多少棵有标号无根树，满足最大度数为$M$。  
前$10 \%$数据：直接爆搜。  
前$30 \%$数据：我们用$prufer$序列求答案，用$prufer$序列列出的式子中，$(n-2)!$是已经确定了的，我们只要确定分母即可。我们考虑每一个点出现了多少次，设$f_{i,j,k}$表示当前到第$i$个点，序列长度为$j$，最大度数为$k$，转移即可。复杂度$O(n^4)$。  
前$50 \%$数据：第三维状态限制了复杂度，这个最大为$M$，直接套路的转化为至多为$M$减去至多为$M-1$即可。然后$DP$就是$O(n^3)$的了。  
前$70 \%$数据：每次转移是相同的，可以直接上快速幂优化。复杂度$O(n^2 \log n)$。  
前$100 \%$数据：转移过程直接$NTT$优化即可。复杂度$O(n \log^2 n)$。  
其实直接从$EGF$考虑更加简单。

## E
其实这题本来是$Alpha1022$的，而且是维护的后缀和。  
但他给我看了以后，我突然觉得这个可以维护后缀积。  
前$20 \%$数据：直接模拟即可。  
对于$a_i=2$的数据：发现答案是等比数列求和，直接求路径长度即可。  
对于是一条链的数据：那就是序列了，在序列上怎么做呢？发现这个是可以分治的，维护一个区间积和区间后缀积的和就行了，转移自己$yy$一下，非常简单，带修改的话，那就在线段树上维护这个分治结构。  
复杂度$O(q \log n)$。  
对于所有数据：基本上会了一条链，整道题就会了，树剖加上线段树去维护那个分治结构就行了，线段树上要多维护一个区间前缀积的和，这道题就做完了。复杂度$O(q \log^2 n)$。  
利用原来后缀和的$idea$是可以在模数为素数情况下做到单次询问$\log n$的，请$Alpha1022$蒟蒻简述一下：

以上均为 SXnoname 之语，我来乱入一下。  
本来后缀和的做法是这样的：维护每个结点到根结点的点权和，然后把路径从 $lca$ 处截断，分别讨论。  
然后是很显然的。

考虑放到后缀积上，发现这个做法只用小改，但是是 $\log^2 n$ 的。  
考虑把维护的东西改成根结点到每个结点的点权前缀积之和。  
然后乱搞。  
修改就把子树乘上 $\frac{a_i + k}{a_i}$ 就好惹。

## F
暂缺，反正撞了先咕一会（
